<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Emulador NES con JSNES</title>
</head>
<body>

<canvas id="screen" width="256" height="240"></canvas>
<input type="file" id="rom" accept=".nes">

<script src="https://unpkg.com/jsnes/dist/jsnes.min.js"></script>

<script>
  const canvas = document.getElementById("screen");
  const ctx = canvas.getContext("2d");

  const nes = new jsnes.NES({
    onFrame: frameBuffer => {
      const img = ctx.createImageData(256, 240);
      for (let i = 0; i < frameBuffer.length; i++) {
        const pixel = frameBuffer[i];
        img.data[i * 4 + 0] = (pixel >> 16) & 0xFF;
        img.data[i * 4 + 1] = (pixel >> 8) & 0xFF;
        img.data[i * 4 + 2] = pixel & 0xFF;
        img.data[i * 4 + 3] = 255;
      }
      ctx.putImageData(img, 0, 0);
    }
  });

  document.getElementById("rom").addEventListener("change", e => {
    const reader = new FileReader();
    reader.onload = () => nes.loadROM(reader.result);
    reader.readAsBinaryString(e.target.files[0]);
  });
</script>

</body>
</html>
